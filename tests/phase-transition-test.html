<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phase Transition Test Suite</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .subtitle {
        opacity: 0.9;
        font-size: 14px;
      }

      main {
        padding: 30px;
      }

      .controls {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      .control-group {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
        align-items: center;
      }

      label {
        font-weight: 600;
        color: #333;
      }

      select,
      input[type="text"],
      button {
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .results {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .result-card {
        background: #f9f9f9;
        border-left: 4px solid #667eea;
        padding: 15px;
        border-radius: 6px;
      }

      .result-card.error {
        border-left-color: #e74c3c;
        background: #fdedec;
      }

      .result-card.success {
        border-left-color: #27ae60;
        background: #eafaf1;
      }

      .result-card h3 {
        margin-bottom: 10px;
        font-size: 14px;
        color: #333;
      }

      .result-card p {
        font-size: 12px;
        color: #666;
        line-height: 1.6;
      }

      .test-log {
        background: #1e1e1e;
        color: #00ff00;
        padding: 20px;
        border-radius: 6px;
        font-family: "Monaco", "Courier New", monospace;
        font-size: 12px;
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
        border: 2px solid #333;
      }

      .log-entry {
        margin-bottom: 8px;
        line-height: 1.4;
      }

      .log-entry.pass {
        color: #00ff00;
      }

      .log-entry.fail {
        color: #ff3333;
      }

      .log-entry.info {
        color: #00ccff;
      }

      .log-entry.phase {
        color: #ffff00;
        font-weight: bold;
      }

      .summary {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
      }

      .summary h2 {
        margin-bottom: 15px;
        color: #333;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
      }

      .summary-item {
        background: white;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
        border: 2px solid #e0e0e0;
      }

      .summary-item.pass {
        border-color: #27ae60;
        background: #eafaf1;
      }

      .summary-item.fail {
        border-color: #e74c3c;
        background: #fdedec;
      }

      .summary-item strong {
        font-size: 24px;
        display: block;
        margin-bottom: 5px;
      }

      .summary-item small {
        color: #666;
        font-size: 12px;
      }

      .phases-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .phase-btn {
        padding: 15px;
        font-size: 14px;
        font-weight: 600;
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        cursor: pointer;
        border-radius: 6px;
        transition: all 0.2s;
      }

      .phase-btn:hover {
        background: #667eea;
        color: white;
      }

      .phase-btn.active {
        background: #667eea;
        color: white;
      }

      .tab-content {
        margin-top: 20px;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .results {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 20px;
        }

        .control-group {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üéÆ Phase Transition Test Suite</h1>
        <p class="subtitle">
          Test di verifica attivazione bottoni e input per tutte le fasi di
          gioco
        </p>
      </header>

      <main>
        <!-- CONTROLS -->
        <div class="controls">
          <div class="control-group">
            <label>Squadra:</label>
            <select id="selectTeam">
              <option value="A">Squadra A</option>
              <option value="B">Squadra B</option>
            </select>
          </div>

          <div class="control-group">
            <label>Fase:</label>
            <select id="selectPhase">
              <option value="lobby">Lobby</option>
              <option value="clues">Clues</option>
              <option value="guess_us">Guess Us</option>
              <option value="conf_us">Conf Us</option>
              <option value="guess_them">Guess Them</option>
              <option value="conf_them">Conf Them</option>
              <option value="review_round">Review Round</option>
            </select>
          </div>

          <div class="control-group">
            <label>Giocatore:</label>
            <select id="selectStatus">
              <option value="active">Attivo</option>
              <option value="inactive">Non Attivo</option>
            </select>
          </div>

          <button onclick="testPhaseTransition()">‚ñ∂Ô∏è Testa Fase</button>
          <button onclick="runAllTests()">üß™ Testa Tutte le Fasi</button>
          <button onclick="clearLog()">üóëÔ∏è Pulisci Log</button>
        </div>

        <!-- TEST LOG -->
        <div class="test-log" id="testLog">
          <div class="log-entry info">// Pronto per il test...</div>
        </div>

        <!-- RESULTS -->
        <div id="resultsContainer"></div>

        <!-- SUMMARY -->
        <div class="summary" id="summaryContainer" class="hidden">
          <h2>üìä Riepilogo Test</h2>
          <div id="summaryContent"></div>
        </div>

        <!-- QUICK PHASE BUTTONS -->
        <div style="margin-top: 30px">
          <h3 style="margin-bottom: 15px">‚ö° Test Rapidi</h3>
          <div class="phases-grid">
            <button class="phase-btn" onclick="quickTest('clues')">
              Test: CLUES
            </button>
            <button class="phase-btn" onclick="quickTest('guess_us')">
              Test: GUESS_US
            </button>
            <button class="phase-btn" onclick="quickTest('conf_us')">
              Test: CONF_US
            </button>
            <button class="phase-btn" onclick="quickTest('guess_them')">
              Test: GUESS_THEM
            </button>
            <button class="phase-btn" onclick="quickTest('conf_them')">
              Test: CONF_THEM
            </button>
            <button class="phase-btn" onclick="quickTest('review_round')">
              Test: REVIEW_ROUND
            </button>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Test Suite Implementation
      class PhaseTransitionTester {
        constructor() {
          this.results = [];
          this.errors = [];
          this.logEntries = [];
        }

        log(message, type = "info") {
          const timestamp = new Date().toLocaleTimeString();
          this.logEntries.push({ message, type, timestamp });
          this.renderLog();
        }

        renderLog() {
          const logContainer = document.getElementById("testLog");
          logContainer.innerHTML = this.logEntries
            .map((entry) => {
              let icon = "üìù";
              if (entry.type === "pass") icon = "‚úÖ";
              if (entry.type === "fail") icon = "‚ùå";
              if (entry.type === "phase") icon = "üéÆ";
              if (entry.type === "info") icon = "‚ÑπÔ∏è";

              return `<div class="log-entry ${entry.type}">${icon} [${entry.timestamp}] ${entry.message}</div>`;
            })
            .join("");
          logContainer.scrollTop = logContainer.scrollHeight;
        }

        getExpectations(phase, isActive) {
          const expectations = {
            clues: {
              ".clue-input": isActive ? "editable" : "disabled",
              "#btn-submit-clues": isActive ? "visible" : "hidden",
            },
            guess_us: {
              ".guess-input": !isActive ? "editable" : "disabled",
              "#btn-submit-tguess-us": !isActive ? "visible" : "hidden",
            },
            conf_us: {
              ".tguess-input": "readonly",
              "#btn-submit-conf": isActive ? "visible" : "hidden",
            },
            guess_them: {
              ".guessthem-input": isActive ? "editable" : "disabled",
              ".hint-input": isActive ? "editable" : "disabled",
              "#btn-submit-tguess-them": isActive ? "visible" : "hidden",
            },
            conf_them: {
              ".guessthem-input": "readonly",
              ".confthem-input": isActive ? "editable" : "readonly",
              ".hint-input": isActive ? "editable" : "disabled",
              "#btn-submit-conf": isActive ? "visible" : "hidden",
            },
            review_round: {
              ".clue-input": "readonly",
              ".guess-input": "readonly",
              'button[id*="submit"]': "hidden",
            },
          };

          return expectations[phase] || {};
        }

        getElementState(selector) {
          const el = document.querySelector(selector);
          if (!el) return { exists: false };

          const isVisible = window.getComputedStyle(el).display !== "none";
          const isDisabled = el.disabled === true;
          const isReadonly = el.readOnly === true;

          if (!isVisible) return { status: "hidden", exists: true };
          if (isDisabled) return { status: "disabled", exists: true };
          if (isReadonly) return { status: "readonly", exists: true };
          return { status: "editable", exists: true };
        }

        async testPhase(team, phase, isActive) {
          this.log(
            `Testing Phase: ${phase} (Team ${team}, ${
              isActive ? "ACTIVE" : "INACTIVE"
            })`,
            "phase"
          );

          const expectations = this.getExpectations(phase, isActive);
          let passed = 0;
          let failed = 0;

          for (const [selector, expectedStatus] of Object.entries(
            expectations
          )) {
            const state = this.getElementState(selector);

            if (!state.exists && expectedStatus !== "hidden") {
              this.log(`‚ö†Ô∏è  Selector not found: ${selector}`, "info");
              continue;
            }

            if (state.status === expectedStatus) {
              this.log(`‚úì ${selector} ‚Üí ${state.status}`, "pass");
              passed++;
            } else {
              this.log(
                `‚úó ${selector} ‚Üí expected "${expectedStatus}", got "${state.status}"`,
                "fail"
              );
              failed++;
              this.errors.push({
                phase,
                selector,
                expected: expectedStatus,
                actual: state.status,
              });
            }
          }

          return { passed, failed };
        }

        async runAllPhases() {
          this.results = [];
          this.errors = [];
          this.logEntries = [];

          const phases = [
            "clues",
            "guess_us",
            "conf_us",
            "guess_them",
            "conf_them",
            "review_round",
          ];
          let totalPassed = 0;
          let totalFailed = 0;

          for (const phase of phases) {
            const activeResult = await this.testPhase("A", phase, true);
            const inactiveResult = await this.testPhase("A", phase, false);

            totalPassed += activeResult.passed + inactiveResult.passed;
            totalFailed += activeResult.failed + inactiveResult.failed;

            this.results.push({
              phase,
              passed: activeResult.passed + inactiveResult.passed,
              failed: activeResult.failed + inactiveResult.failed,
            });
          }

          this.log(
            `\nüìä SUMMARY: ${totalPassed} passed, ${totalFailed} failed`,
            "info"
          );
          this.renderSummary(totalPassed, totalFailed);
        }

        renderSummary(passed, failed) {
          const summaryContainer = document.getElementById("summaryContainer");
          const summaryContent = document.getElementById("summaryContent");
          const total = passed + failed;
          const percentage = total > 0 ? Math.round((passed / total) * 100) : 0;

          summaryContainer.classList.remove("hidden");

          summaryContent.innerHTML = `
                    <div class="summary-grid">
                        <div class="summary-item ${
                          passed > failed ? "pass" : "fail"
                        }">
                            <strong>${passed}</strong>
                            <small>Passed</small>
                        </div>
                        <div class="summary-item ${
                          failed === 0 ? "pass" : "fail"
                        }">
                            <strong>${failed}</strong>
                            <small>Failed</small>
                        </div>
                        <div class="summary-item">
                            <strong>${percentage}%</strong>
                            <small>Success Rate</small>
                        </div>
                        <div class="summary-item">
                            <strong>${total}</strong>
                            <small>Total Tests</small>
                        </div>
                    </div>
                    ${
                      this.errors.length > 0
                        ? `
                        <div style="margin-top: 20px; padding: 15px; background: #fdedec; border-radius: 6px; border-left: 4px solid #e74c3c;">
                            <strong style="color: #c0392b;">Errori Trovati:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px; color: #666;">
                                ${this.errors
                                  .map(
                                    (e) => `
                                    <li>${e.phase}: ${e.selector} - Expected "${e.expected}", got "${e.actual}"</li>
                                `
                                  )
                                  .join("")}
                            </ul>
                        </div>
                    `
                        : `
                        <div style="margin-top: 20px; padding: 15px; background: #eafaf1; border-radius: 6px; border-left: 4px solid #27ae60;">
                            <strong style="color: #27ae60;">‚úÖ Tutti i test passati!</strong>
                        </div>
                    `
                    }
                `;
        }
      }

      // Global tester instance
      const tester = new PhaseTransitionTester();

      // UI Functions
      function testPhaseTransition() {
        const team = document.getElementById("selectTeam").value;
        const phase = document.getElementById("selectPhase").value;
        const isActive =
          document.getElementById("selectStatus").value === "active";

        tester.testPhase(team, phase, isActive).then(() => {
          const resultsHtml = tester.results
            .map(
              (r) => `
                    <div class="result-card ${
                      r.failed === 0 ? "success" : "error"
                    }">
                        <h3>Fase: ${r.phase}</h3>
                        <p>‚úÖ Passed: ${r.passed}<br>‚ùå Failed: ${r.failed}</p>
                    </div>
                `
            )
            .join("");
          document.getElementById("resultsContainer").innerHTML = resultsHtml;
        });
      }

      function runAllTests() {
        document.getElementById("resultsContainer").innerHTML =
          "<p>Esecuzione test...</p>";
        tester.runAllPhases();
      }

      function clearLog() {
        tester.logEntries = [];
        tester.renderLog();
        document.getElementById("resultsContainer").innerHTML = "";
        document.getElementById("summaryContainer").classList.add("hidden");
      }

      function quickTest(phase) {
        tester.logEntries = [];
        document.getElementById("selectPhase").value = phase;
        tester.testPhase("A", phase, true).then(() => {
          tester.testPhase("A", phase, false);
        });
      }

      // Initial log
      tester.log(
        "Test Suite Caricato - Seleziona una fase per iniziare",
        "info"
      );
    </script>
  </body>
</html>
